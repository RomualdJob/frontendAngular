<div class="container mt-4">
  <!-- En-tête et barre de recherche -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 fw-bold text-primary mb-0">Freelances Disponibles</h1>
        <div class="d-flex align-items-center gap-3">
          <span class="badge bg-primary fs-6">{{ filteredFreelances.length }}/{{ freelances.length }} freelances</span>
          <button class="btn btn-outline-secondary btn-sm" (click)="resetFilters()">
            <i class="cil-reload"></i> Réinitialiser
          </button>
        </div>
      </div>
      
      <div class="row g-3">
        <div class="col-md-4">
          <div class="input-group">
            <span class="input-group-text bg-light border-end-0">
              <i class="cil-magnifying-glass"></i>
            </span>
            <input 
              type="text" 
              class="form-control border-start-0" 
              placeholder="Nom, compétence, description..."
              [(ngModel)]="searchTerm"
              (input)="filterFreelances()">
          </div>
        </div>
        <div class="col-md-3">
          <select class="form-select" [(ngModel)]="selectedSkill" (change)="filterFreelances()">
            <option value="">Toutes les compétences</option>
            <option *ngFor="let skill of allSkills" [value]="skill">{{ skill }}</option>
          </select>
        </div>
        <div class="col-md-3">
          <select class="form-select" [(ngModel)]="selectedLevel" (change)="filterFreelances()">
            <option value="">Tous les niveaux</option>
            <option *ngFor="let level of allLevels" [value]="level">{{ level }}</option>
          </select>
        </div>
        <div class="col-md-2">
          <div class="form-text text-center">
            {{ filteredFreelances.length }} résultat(s)
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Liste des freelances - 4 par ligne -->
  <div class="row g-3">
    <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6" *ngFor="let freelance of filteredFreelances">
      <div class="card square-card shadow-sm freelance-card">
        <div class="card-body d-flex flex-column">
          <!-- En-tête de la carte -->
          <div class="d-flex align-items-start mb-2">
            <div class="flex-grow-1">
              <div class="d-flex align-items-center gap-1 mb-1">
                <h6 class="card-title fw-semibold mb-0 small">{{ freelance.name }}</h6>
                <span class="badge small" [ngClass]="{
                  'bg-success': freelance.available,
                  'bg-secondary': !freelance.available
                }">
                  {{ freelance.available ? '✓' : '✗' }}
                </span>
              </div>
              <p class="text-muted small mb-1">{{ freelance.title }}</p>
              <div class="d-flex align-items-center">
                <span class="text-warning small">★ {{ freelance.rating }}</span>
                <small class="text-muted ms-1">({{ freelance.reviews }})</small>
              </div>
            </div>
            <span class="badge small" [ngClass]="{
              'bg-success': freelance.level === 'Senior',
              'bg-info': freelance.level === 'Expert', 
              'bg-warning': freelance.level === 'Intermediate'
            }">{{ freelance.level.charAt(0) }}</span>
          </div>

          <!-- Description réduite -->
          <p class="small text-muted mb-2 line-clamp-2">{{ freelance.description }}</p>

          <!-- Compétences réduites -->
          <div class="mb-2 flex-grow-1">
            <div class="skills-container-small">
              <span *ngFor="let skill of freelance.skills.slice(0, 4)" 
                    class="badge bg-light text-dark me-1 mb-1 skill-badge small">
                {{ skill }}
              </span>
              <span *ngIf="freelance.skills.length > 4" class="badge bg-light text-muted small">
                +{{ freelance.skills.length - 4 }}
              </span>
            </div>
          </div>

          <!-- Localisation et taux -->
          <div class="d-flex justify-content-between align-items-center mt-auto">
            <div class="d-flex align-items-center">
              <i class="cil-location-pin text-muted me-1 small"></i>
              <small class="text-muted">{{ getShortLocation(freelance.location) }}</small>
            </div>
            <span class="fw-bold text-success small">{{ freelance.rate }}/h</span>
          </div>
        </div>

        <!-- Footer de la carte -->
        <div class="card-footer bg-transparent border-top-0 pt-0">
          <div class="d-flex gap-1">
            <button class="btn btn-outline-primary btn-sm flex-grow-1" 
                    [disabled]="!freelance.available"
                    (click)="openContactModal(freelance)">
              {{ freelance.available ? 'Contacter' : 'Indisponible' }}
            </button>
            <button class="btn btn-outline-secondary btn-sm">
              <i class="cil-heart"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Message si aucun résultat -->
  <div *ngIf="filteredFreelances.length === 0" class="text-center py-5">
    <i class="cil-magnifying-glass display-1 text-muted mb-3"></i>
    <h4 class="text-muted">Aucun freelance trouvé</h4>
    <p class="text-muted">Essayez de modifier vos critères de recherche</p>
    <button class="btn btn-primary" (click)="resetFilters()">
      Voir tous les freelances
    </button>
  </div>
</div>

<!-- Modal de contact -->
<div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'" tabindex="-1" [attr.aria-hidden]="!showModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content contact-modal">
      <div class="modal-header border-bottom-0 pb-0">
        <h5 class="modal-title fw-bold text-primary">
          <i class="cil-phone me-2"></i>
          Contacter {{ selectedFreelance?.name }}
        </h5>
        <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
      </div>
      
      <div class="modal-body text-center py-4">
        <!-- Avatar et infos -->
        <div class="freelance-avatar mb-4">
          <div class="avatar-circle bg-primary text-white">
            {{ selectedFreelance?.name?.charAt(0) }}
          </div>
          <h6 class="mt-2 mb-1">{{ selectedFreelance?.name }}</h6>
          <p class="text-muted small mb-3">{{ selectedFreelance?.title }}</p>
        </div>

        <!-- Numéro de téléphone -->
        <div class="phone-section mb-4">
          <div class="phone-number-container p-3 rounded-3 bg-light">
            <i class="cil-phone text-primary me-2"></i>
            <span class="phone-number fw-bold fs-5">{{ selectedFreelance?.phone || '+33 6 12 34 56 78' }}</span>
          </div>
          <p class="text-muted small mt-2">
            <i class="cil-clock me-1"></i>
            Disponible de 9h à 18h
          </p>
        </div>

        <!-- Actions -->
        <div class="action-buttons d-grid gap-2">
          <button class="btn btn-primary btn-lg" (click)="copyPhoneNumber()">
            <i class="cil-copy me-2"></i>
            Copier le numéro
          </button>
          <a [href]="'tel:' + (selectedFreelance?.phone || '+33612345678')" class="btn btn-success btn-lg">
            <i class="cil-phone me-2"></i>
            Appeler maintenant
          </a>
          <button class="btn btn-outline-secondary" (click)="closeModal()">
            Fermer
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Overlay -->
<div class="modal-backdrop fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'"></div>